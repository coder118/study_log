# TCP/IP 기본 흐름


클라이언트와 서버가 가운데에 인터넷을 두고 어떻게 소통하는지 살펴본다.

![alt text](/Network/network_images/Screenshot_20260217_213209_Samsung%20Notes.jpg)


그림으로 그려가며 공부한 내용의 순서를 분홍색 번호로 표시해두었다.


### File A.bmp(1.4MB)이 주어졌을때 서버가 클라이언트로 파일을 보내는 과정


1. 1.4MB파일이 너무 크기 때문에 크기를 쪼갠다. 여기서는 64KB의 사이즈로 쪼갠다. 이후 socket과 tcp의 맞닿은 부분의 buffer#1(socket에 존재하는 버퍼)(=메모리, 첫번째 버퍼라는 뜻이다)에 들어간다.

2. 초록색 무늬가 64KB의 파일를 말한다. tcp 쪽에 buffer#2가 존재한다. 거기에 64KB파일이 복사되어 들어간다. 
그 파일이 segment 단위로 쪼개져서 쪼개진 조각은 packet으로 감싸진다.

감싸진 packet이 NIC라는 곳으로 내려와서 Frame이라는 공간에 담긴다. 

(segment는 tcp에서 사용하는 것, packet은 Ip에서 사용하는 것)

3. packet은 택배 박스에 비유하고 Frame은 트럭에 비유를 했다. frame이라는 곳에 packet이 들어가서 인터넷을 통해 전송된다. (frame은 이동되는 중에 바뀐다. 즉, 출발 트럭과 도착 트럭이 다르다는 것.)

4. frame이 클라이언트 쪽에 도착해서 Ip에 도달하게 되면 frame은 사라지고 packet을 꺼내고 tcp로 올라가면서 packet 내부의 segment를 꺼낸다. 그 꺼낸 값이 TCP buffer에 들어가는 것을 확인할 수 있다.

5. 여기서 중요한 개념. segment가 2개 쌓였을때 데이터를 클라이언트에서 잘 받았다고 신호를 보내주는데 그게 ACK이다.
ACK 내부에는 WindowSize(tcp buffer의 공간), 그 다음 64KB 데이터의 정보를 담고 있다. 

6. 서버에서 신호를 받는다고 바로 보내는 그 다음 64KB데이터를 보내주는 것이 아니다. 
일단 2개의 데이터를 보내면 ack신호를 받기 전까지 그 다음 데이터를 보내지 않고 wait상태에 걸린다.(=여기서 속도지연이 발생하는 것이다.)

만약, window size 즉, 수신측에 데이터를 받을 만한 공간이 없다면 서버는 데이터를 보내지 않는다.



이런 과정을 통해 서버와 클라이언트가 소통하는 흐름을 그려볼 수 있다.

